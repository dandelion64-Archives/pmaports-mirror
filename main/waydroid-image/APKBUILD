# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=waydroid-image
pkgver=17.1.20220419
pkgrel=0
_pkgver="17.1-20220316"
_pkgver_images_vendor="17.1-20220419"
pkgdesc="Android containers for use in Waydroid"
url="https://github.com/waydroid/waydroid"
# Only x86, armv7, x86_64 and aarch64 supported upstream
arch="noarch !armhf"
license="Apache-2.0"
source="
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_x86_64/lineage-$_pkgver-VANILLA-waydroid_x86_64-system.zip
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_arm64/lineage-$_pkgver-VANILLA-waydroid_arm64-system.zip
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_x86/lineage-$_pkgver-VANILLA-waydroid_x86-system.zip
	https://sourceforge.net/projects/waydroid/files/images/system/lineage/waydroid_arm/lineage-$_pkgver-VANILLA-waydroid_arm-system.zip

	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_arm64/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_arm64-vendor.zip
	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_x86_64/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_x86_64-vendor.zip
	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_x86/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_x86-vendor.zip
	https://sourceforge.net/projects/waydroid/files/images/vendor/waydroid_arm/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_arm-vendor.zip
	"
options="!check pmb:cross-native" # No code to test
install_if="waydroid"

case "$CARCH" in
	aarch64) _imgarch="arm64" ;;
	armv7) _imgarch="arm" ;;
	*) _imgarch="$CARCH" ;;
esac

unpack() {
	# Overwriting as it's easier to install directly while unzipping and we
	# don't need other arches than the native unpacked
	:
}

package() {
	install -dm755 "$pkgdir"/usr/share/waydroid-extra/images

	unzip -n \
			-q "$srcdir"/lineage-$_pkgver-VANILLA-waydroid_$_imgarch-system.zip \
			-d "$pkgdir"/usr/share/waydroid-extra/images
	unzip -n \
			-q "$srcdir"/lineage-$_pkgver_images_vendor-MAINLINE-waydroid_$_imgarch-vendor.zip \
			-d "$pkgdir"/usr/share/waydroid-extra/images
}

sha512sums="
da5c743b0360aaf1c7861a0085da7c2b2a765fcbd6cdcea925f0f5f6059707523f555f1cba52c45f5e746beb3cbdd624f9a2edd88292f42cc5fcda1c2e0f6036  lineage-17.1-20220316-VANILLA-waydroid_x86_64-system.zip
530b0e0588556b3222f7b0a8da34dfefaae5239daf134d619f4d71e53d8329aba811a743cc2ac9877b257772d268c38265a279fd2e69fec875e97fcb4fbce7ca  lineage-17.1-20220316-VANILLA-waydroid_arm64-system.zip
9e61ef412811a64ae882f16132b93f99d4071b38f46d4ee0c5b8b0f0e00065ffcc82bae5a6346d4f979e481466308e055cd6e338fd9608de92089b42a0e15ee9  lineage-17.1-20220316-VANILLA-waydroid_x86-system.zip
e005d70a62267d2107d01f0eea73a33cd483db93f48bd5734fe3fa70044b485c77085135d2c36bd2eb955ae48ecb2d442d4073e3da7abea84c1bfc3efc494e01  lineage-17.1-20220316-VANILLA-waydroid_arm-system.zip
39d19294c743d9dfa6a1325684b6cda51cb069ad30360c1fff02c85fbed9a3b97fe854db0eb0e114b26d277f20c7c127deec41832aa598d8537e10495da7a84d  lineage-17.1-20220419-MAINLINE-waydroid_arm64-vendor.zip
2cb3a4671ccbaecdc7147d07f786705c7a2fe186bb1ec9d505dbdb146bde00dc2d16296326a66d5528e16b4a5d5209ddd41f898ba4b30d298e5322d6a81bd359  lineage-17.1-20220419-MAINLINE-waydroid_x86_64-vendor.zip
b148b5e55b44a0a6eeb6d4a343264e0fcbe1177f09a2384a38ad2e1e362e4e7c7e4be7e3632ea934105f4cec93ab577916c5c6bb44fd5c0dabad3f7accd2c69b  lineage-17.1-20220419-MAINLINE-waydroid_x86-vendor.zip
64bbb5991135184e7230fe9bb3d7286aac21e7d1d21d2614efe0447dabd6aac9d9c379f02f8ca07df78de9cf83c29d7d52b91c3b9b5d5f08391fa81bf45fac23  lineage-17.1-20220419-MAINLINE-waydroid_arm-vendor.zip
"
